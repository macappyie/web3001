<!DOCTYPE html>
<html>
<head>
  <title>MoneyAssure Intraday Dashboard</title>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content="180">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>ğŸ“Š MoneyAssure Intraday Dashboard</h1>

{% macro table(title, data, is_gainer=True, is_gap=False) %}
<div class="box">
  <h3>{{ title }}</h3>
  <table>
    <tr>
      <th>Stock</th>
      <th>LTP</th>
      <th>%</th>
      <th>Volume (9:15)</th>
      <th>9:15 %</th>
      <th>10:00 %</th>
      <th>Total Vol</th>
    </tr>

    {% if data|length == 0 %}
      <tr>
        <td colspan="7" class="empty">No stocks</td>
      </tr>
    {% endif %}

    {% for s in data %}
    <tr>
      <td>{{ s.symbol }}</td>
      <td>{{ s.ltp }}</td>

      {% if is_gap %}
        <td class="{{ 'green' if s.gap > 0 else 'red' }}">{{ s.gap }}%</td>
      {% else %}
        <td class="{{ 'green' if is_gainer else 'red' }}">{{ s.change }}%</td>
      {% endif %}

      <td>{{ s.volume_fmt }}</td>

      <td>
        {% if is_gainer %}
          {{ s.hl_pct.split('/')[0] }}
        {% else %}
          {{ s.hl_pct.split('/')[1] }}
        {% endif %}
      </td>

      <td class="{{ 'green' if is_gainer else 'red' }}">
        {% if is_gainer %}
          {{ s.ten_am_high_pct }}%
        {% else %}
          {{ s.ten_am_low_pct }}%
        {% endif %}
      </td>

      <td>
        {{ s.total_volume_fmt }}
        {% if s.big == "BUY" %}
          <span class="green">ğŸ˜ BIG BUY</span>
        {% elif s.big == "SELL" %}
          <span class="red">ğŸ˜ BIG SELL</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
</div>
{% endmacro %}

<!-- ================= ABOVE 2% ================= -->
<div class="section">
  <h2>ğŸ”¥ Above 2% (ğŸŸ¢ {{ r1b_count }} | ğŸ”´ {{ r1s_count }})</h2>
  <div class="container">
    {{ table("Gainers", r1b, true) }}
    {{ table("Losers", r1s, false) }}
  </div>
</div>

<!-- ================= 1.5% â€“ 2% ================= -->
<div class="section">
  <h2>ğŸ“ˆ 1.5% â€“ 2% (ğŸŸ¢ {{ r2b_count }} | ğŸ”´ {{ r2s_count }})</h2>
  <div class="container">
    {{ table("Gainers", r2b, true) }}
    {{ table("Losers", r2s, false) }}
  </div>
</div>

<!-- ================= 0.8% â€“ 1.5% ================= -->
<div class="section">
  <h2>ğŸŸ¢ 0.8% â€“ 1.5% (ğŸŸ¢ {{ r3b_count }} | ğŸ”´ {{ r3s_count }})</h2>
  <div class="container">
    {{ table("Gainers", r3b, true) }}
    {{ table("Losers", r3s, false) }}
  </div>
</div>

<!-- ================= GAP UP / GAP DOWN ================= -->
<div class="section">
  <h2>ğŸš€ Gap Up / Gap Down</h2>
  <p style="text-align:center; opacity:0.7;">
    Gap Up â‰¥ +1.5% | Gap Down â‰¤ -1.5%
  </p>
  <div class="container">
    {{ table("Gap Up", gap_up, true, true) }}
    {{ table("Gap Down", gap_down, false, true) }}
  </div>
</div>

</body>
</html>

