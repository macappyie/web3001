<!DOCTYPE html>
<html>
<head>
    <title>{{ symbol }} Chart</title>

    <script src="https://unpkg.com/lightweight-charts@4.0.1/dist/lightweight-charts.standalone.production.js"></script>

    <style>
        body { margin: 0; background: #000; }
        #title {
            background: #000;
            color: #fff;
            padding: 10px;
            font-size: 20px;
            font-weight: bold;
        }
        #chart {
            width: 100%;
            height: calc(100vh - 60px);
        }
    </style>
</head>

<body>

<div id="title">ðŸ“ˆ {{ symbol }} â€” 5-Min Chart</div>
<div id="chart"></div>

<script>
const container = document.getElementById("chart");

const chart = LightweightCharts.createChart(container, {
    width: container.clientWidth,
    height: container.clientHeight,
    layout: { background: { color:"#000" }, textColor:"#ccc" },
    grid: {
        vertLines: { color:"#1e1e1e" },
        horzLines: { color:"#1e1e1e" }
    },
    timeScale: { timeVisible:true }
});

const candleSeries = chart.addCandlestickSeries({
    upColor:"#00c853",
    downColor:"#ef5350",
    borderUpColor:"#00c853",
    borderDownColor:"#ef5350",
    wickUpColor:"#00c853",
    wickDownColor:"#ef5350"
});

const smaSeries = chart.addLineSeries({
    color:"#ffa726",
    lineWidth:2
});

const volumeSeries = chart.addHistogramSeries({
    color:"rgba(0,122,255,0.5)",
    priceFormat:{ type:"volume" },
    priceScaleId:"volume",
    scaleMargins:{ top:0.8, bottom:0 }
});

fetch(`/api/candles/{{ symbol }}`)
    .then(r => r.json())
    .then(d => {
        candleSeries.setData(d.candles);
        smaSeries.setData(d.sma50);
        volumeSeries.setData(d.volume);
        chart.timeScale().fitContent();
    });

window.addEventListener("resize", () => {
    chart.resize(container.clientWidth, container.clientHeight);
});
</script>

</body>
</html>

